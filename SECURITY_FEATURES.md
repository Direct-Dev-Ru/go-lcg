# üîí –§—É–Ω–∫—Ü–∏–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ LCG

## üõ°Ô∏è –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–Ω—É–∂–¥–µ–Ω–∏–µ –∫ HTTPS

### –õ–æ–≥–∏–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –Ω—É–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å HTTPS:

1. **–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Ö–æ—Å—Ç—ã** (–Ω–µ localhost/127.0.0.1) ‚Üí **–ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ HTTPS**
2. **–ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Ö–æ—Å—Ç—ã** (localhost/127.0.0.1) ‚Üí HTTP (–µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ –∏–Ω–æ–µ)
3. **–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `LCG_SERVER_ALLOW_HTTP=true`** ‚Üí —Ä–∞–∑—Ä–µ—à–∞–µ—Ç HTTP –¥–ª—è –ª—é–±—ã—Ö —Ö–æ—Å—Ç–æ–≤

### –ü—Ä–∏–º–µ—Ä—ã

```bash
# –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ - –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ HTTPS
LCG_SERVER_HOST=192.168.1.100 lcg serve
# –†–µ–∑—É–ª—å—Ç–∞—Ç: https://192.168.1.100:8080

# –ë–µ–∑–æ–ø–∞—Å–Ω–æ - HTTP –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
LCG_SERVER_HOST=localhost lcg serve  
# –†–µ–∑—É–ª—å—Ç–∞—Ç: http://localhost:8080

# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ HTTP –¥–ª—è –ª—é–±–æ–≥–æ —Ö–æ—Å—Ç–∞
LCG_SERVER_HOST=192.168.1.100 LCG_SERVER_ALLOW_HTTP=true lcg serve
# –†–µ–∑—É–ª—å—Ç–∞—Ç: http://192.168.1.100:8080
```

## üîê SSL/TLS —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –µ—Å–ª–∏:

1. –ù–µ —É–∫–∞–∑–∞–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ `LCG_SERVER_SSL_CERT_FILE` –∏ `LCG_SERVER_SSL_KEY_FILE`
2. –ù–µ –Ω–∞–π–¥–µ–Ω—ã —Ñ–∞–π–ª—ã –≤ `~/.config/lcg/server/ssl/cert.pem` –∏ `~/.config/lcg/server/ssl/key.pem`

### –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

``` text
~/.config/lcg/
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ server/
‚îÇ       ‚îî‚îÄ‚îÄ ssl/
‚îÇ           ‚îú‚îÄ‚îÄ cert.pem    # –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
‚îÇ           ‚îî‚îÄ‚îÄ key.pem     # –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|------------|----------|--------------|
| `LCG_CONFIG_FOLDER` | –ü–∞–ø–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ | `~/.config/lcg/config` |
| `LCG_SERVER_ALLOW_HTTP` | –†–∞–∑—Ä–µ—à–∏—Ç—å HTTP –¥–ª—è –ª—é–±—ã—Ö —Ö–æ—Å—Ç–æ–≤ | `false` |
| `LCG_SERVER_SSL_CERT_FILE` | –ü—É—Ç—å –∫ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—É | `""` (–∞–≤—Ç–æ) |
| `LCG_SERVER_SSL_KEY_FILE` | –ü—É—Ç—å –∫ –∫–ª—é—á—É | `""` (–∞–≤—Ç–æ) |

## üöÄ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π —Ä–µ–∂–∏–º (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

```bash
# –õ–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä - HTTP
lcg serve

# –í–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–µ—Ä - –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ HTTPS
LCG_SERVER_HOST=192.168.1.100 lcg serve
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
LCG_SERVER_SSL_CERT_FILE=/path/to/cert.pem \
LCG_SERVER_SSL_KEY_FILE=/path/to/key.pem \
lcg serve

# –†–∞–∑—Ä–µ—à–∏—Ç—å HTTP –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö —Ö–æ—Å—Ç–æ–≤
LCG_SERVER_HOST=192.168.1.100 \
LCG_SERVER_ALLOW_HTTP=true \
lcg serve
```

### Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

```dockerfile
FROM golang:1.21-alpine AS builder
# ... build steps ...

FROM alpine:latest
COPY --from=builder /app/lcg /usr/local/bin/
ENV LCG_SERVER_HOST=0.0.0.0
ENV LCG_SERVER_ALLOW_HTTP=false
CMD ["lcg", "serve"]
```

### Systemd —Å–µ—Ä–≤–∏—Å

```ini
[Unit]
Description=LCG Server
After=network.target

[Service]
Type=simple
User=lcg
WorkingDirectory=/opt/lcg
ExecStart=/opt/lcg/lcg serve
Environment=LCG_SERVER_HOST=0.0.0.0
Environment=LCG_SERVER_ALLOW_HTTP=false
Restart=always

[Install]
WantedBy=multi-user.target
```

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞

–°–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Å:

- **–†–∞–∑–º–µ—Ä –∫–ª—é—á–∞**: 2048 –±–∏—Ç RSA
- **–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è**: 1 –≥–æ–¥
- **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ö–æ—Å—Ç—ã**: localhost, 127.0.0.1, —É–∫–∞–∑–∞–Ω–Ω—ã–π —Ö–æ—Å—Ç
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: Server Authentication

### –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Ö–æ—Å—Ç—ã

–°–ª–µ–¥—É—é—â–∏–µ —Ö–æ—Å—Ç—ã —Å—á–∏—Ç–∞—é—Ç—Å—è –±–µ–∑–æ–ø–∞—Å–Ω—ã–º–∏ –¥–ª—è HTTP:

- `localhost`
- `127.0.0.1`
- `::1` (IPv6 localhost)

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

```go
// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ö–æ—Å—Ç–∞
if !ssl.IsSecureHost(host) {
    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ HTTPS
    useHTTPS = true
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è HTTP
if config.AppConfig.Server.AllowHTTP {
    useHTTPS = false
}
```

## üõ†Ô∏è –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```bash
# –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
lcg config --full | jq '.server'

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
ls -la ~/.config/lcg/config/server/ssl/

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
env | grep LCG_SERVER
```

### –õ–æ–≥–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

```bash
# –ó–∞–ø—É—Å–∫ —Å –æ—Ç–ª–∞–¥–∫–æ–π
LCG_SERVER_HOST=192.168.1.100 lcg serve --debug

# –ü—Ä–æ–≤–µ—Ä–∫–∞ SSL
openssl x509 -in ~/.config/lcg/config/server/ssl/cert.pem -text -noout
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **–°–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã** - –±—Ä–∞—É–∑–µ—Ä—ã –±—É–¥—É—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
2. **–ü—Ä–æ–¥–∞–∫—à–µ–Ω** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–∞—Å—Ç–æ—è—â–∏–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –æ—Ç CA
3. **–°–µ—Ç–µ–≤–æ–π –¥–æ—Å—Ç—É–ø** - HTTPS –∑–∞—â–∏—â–∞–µ—Ç —Ç—Ä–∞—Ñ–∏–∫, –Ω–æ –Ω–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

1. **HTTPS** - –Ω–µ–±–æ–ª—å—à–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ CPU –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
2. **–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã** - –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑, –∑–∞—Ç–µ–º –∫—ç—à–∏—Ä—É—é—Ç—Å—è
3. **–ü–∞–º—è—Ç—å** - —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤ –ø–∞–º—è—Ç—å –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ

## üìö –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `config/config.go` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- `ssl/ssl.go` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏  
- `serve/serve.go` - HTTP/HTTPS —Å–µ—Ä–≤–µ—Ä
- `SECURITY_FEATURES.md` - —ç—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

---

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ç–µ–ø–µ—Ä—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Ö–æ—Å—Ç–∞!
